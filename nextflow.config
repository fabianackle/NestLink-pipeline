// Default parameters
params {
    data                    = 'data/calls.bam'
    reference               = 'data/reference.fasta'
    filter_quality          = 96.84
    filter_min_length       = 1600
    filter_max_length       = 1900
    extract_barcode_adapter = 'cagggccccTCAAGA...CTCGTGCCCAGAGGC'
    barcode_regex           = '^GGTAGT(GCA|GTT|GAT|CCA|GAA|ACT|GGT|TCT|TAC|CTG|TGG|CAG|TTC|AAC){6,8}(TGGCGG|TGGCTGCGG|TGGCAGTCTCGG|TGGCAGGAAGGAGGTCGG)$'
    barcode_min_coverage    = 10
    barcode_5p              = 'ccccTCAAGA'
    barcode_3p              = 'CTCGTGCCCAGAGG'
    orf_5p                  = 'TGATCCGCC'
    orf_3p                  = 'GCAAGCTCCAGTGGC'
    translate_barcode       = true
    outdir                  = 'results'
}

plugins {
    id 'nf-schema@2.6.1'
}

validation.help.enabled = true

process {
    cpus  = 8
    shell = ['/bin/bash', '-euo', 'pipefail']
}


profiles {
    conda {
        conda.enabled       = true
        conda.useMamba      = true
        conda.createTimeout = '1 h'
    }

    docker {
        docker.enabled = true
    }

    apptainer {
        apptainer.enabled     = true
        apptainer.pullTimeout = '1 h'
        //apptainer.cacheDir = '/home/user/data/apptainer/'
        apptainer.autoMounts  = true
        apptainer.runOptions  = '--nv'
    }

    s3it {
        process {
            executor = 'slurm'
            memory   = '16 GB'
            time     = '1 h'

            withName: DORADO_CONSENSUS {
                clusterOptions = '--gpus=1'
                memory         = '64 GB'
            }

            withName: VARIANT_CALLING {
                cpus = 1
                time = '10 m'
            }

            withName: DUCKDB {
                time = '10 m'
            }
        }
    }
}
